@name Mario Underwater Theme
@outputs [I PAL Tempo AV BV CV Max MUL M2 AD BD CD Vol]
@outputs [NEWLINE Name AS BS CS Mode]:string [E O]:entity
@persist [T A B C]:array

if(first())
{
    Vol=255
    PAL=1

    O=owner()
    E=entity()

    NEWLINE = toChar(10)
    Name = "Mario Underwater Theme"+NEWLINE+"Author: Jasongamer"+NEWLINE+"Modifed & converted to E2 by TAbdiukov"+NEWLINE
    Mode = "No Mode"
    Tempo = 1

    setName(Name+"Loading")

    AS = "synth/25_pwm_440.wav"
    BS = "synth/75_pwm_440.wav"
    CS = "synth/tri.wav"

# init:
    A = array()
    B = array()
    C = array()

# trackA:
## Intro
    T=array(73,73,73,73, 75,75,75,75, 77,77,77,77,   78,78,78,78, 80,80,80,80, 81,81,81,81)
    A=A:add(T)
    T=array(82,0,82,0, 82,82,82,0, 82,82,82,0,   82,82,82,82, 82,82,82,0, 0,0,78,78)
    A=A:add(T)

## Part 1
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   86,86,86,86, 86,86,86,86, 86,86,86,0)
    A=A:add(T)
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   0,0,78,78, 80,80,82,82, 83,83,85,85)
    A=A:add(T)
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   86,86,86,86, 86,86,86,0, 88,88,88,0)
    A=A:add(T)
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   0,0,0,0, 0,0,0,0, 0,0,78,78)
    A=A:add(T)
    T=array(85,85,85,85, 85,85,85,85, 85,85,85,0,   84,84,84,84, 84,84,84,84, 84,84,84,0)
    A=A:add(T)
    T=array(85,85,85,85, 85,85,85,85, 85,85,85,0,   0,0,78,78, 80,80,82,82, 83,83,84,84)
    A=A:add(T)
    T=array(85,85,85,85, 85,85,85,85, 85,85,85,0,   78,78,78,78, 78,78,78,0, 88,88,88,0)
    A=A:add(T)
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   0,0,0,0, 0,0,0,0, 0,0,78,78)
    A=A:add(T)

## Part 2
    T=array(90,90,90,90, 90,90,90,90, 90,90,90,0,   90,90,90,90, 90,90,90,90, 90,90,90,0)
    A=A:add(T)
    T=array(90,90,90,90, 90,90,90,90, 90,90,90,0,   90,90,90,0, 92,92,0,0, 0,0,90,90)
    A=A:add(T)
    T=array(88,88,88,88, 88,88,88,88, 88,88,88,0,   88,88,88,88, 88,88,88,88, 88,88,88,0)
    A=A:add(T)
    T=array(88,88,88,88, 88,88,88,88, 88,88,88,0,   88,88,88,0, 90,90,0,0, 0,0,88,88)
    A=A:add(T)
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   80,80,80,0, 82,82,82,0, 88,88,88,0)
    A=A:add(T)
    T=array(87,0,87,0, 87,87,87,87, 87,0,82,82,   83,83,83,83, 83,83,83,83, 83,83,83,0,0)
    A=A:add(T)


# trackB:
## Intro
    T=array(73,73,73,73, 72,72,72,72, 71,71,71,71,   70,70,70,70, 71,71,71,71, 72,72,72,72)
    B=B:add(T)
    T=array(73,0,73,0, 73,73,73,0, 75,75,75,0,   76,76,76,76, 76,76,76,0, 0,0,0,0)
    B=B:add(T)

## Part 1
    T=array(78,78,78,78, 78,78,78,78, 78,78,78,0,   77,77,77,77, 77,77,77,77, 77,77,77,0)
    B=B:add(T)
    T=array(78,78,78,78, 78,78,78,78, 78,78,78,0,   0,0,0,0, 0,0,0,0, 0,0,0,0)
    B=B:add(T)
    T=array(78,78,78,78, 78,78,78,78, 78,78,78,0,   77,77,77,77, 77,77,77,0, 80,80,80,0)
    B=B:add(T)
    T=array(78,78,78,78, 78,78,78,78, 78,78,78,0,   0,0,0,0, 0,0,0,0, 0,0,0,0)
    B=B:add(T)
    T=array(76,76,76,76, 76,76,76,76, 76,76,76,0,   75,75,75,75, 75,75,75,75, 75,75,75,0)
    B=B:add(T)
    T=array(76,76,76,76, 76,76,76,76, 76,76,76,0,   0,0,0,0, 0,0,0,0, 0,0,0,0)
    B=B:add(T)
    T=array(76,76,76,76, 76,76,76,76, 76,76,76,0,   70,70,70,70, 70,70,70,0, 80,80,80,0)
    B=B:add(T)
    T=array(78,78,78,78, 78,78,78,78, 78,78,78,0,   0,0,0,0, 0,0,0,0, 0,0,0,0)
    B=B:add(T)

## Part 2
    T=array(87,87,87,87, 87,87,87,87, 87,87,87,0,   85,85,85,85, 85,85,85,85, 85,85,85,0)
    B=B:add(T)
    T=array(84,84,84,84, 84,84,84,84, 84,84,84,0,   0,0,0,0, 0,0,0,0, 0,0,0,0)
    B=B:add(T)
    T=array(85,85,85,85, 85,85,85,85, 85,85,85,0,   84,84,84,84, 84,84,84,84, 84,84,84,0)
    B=B:add(T)
    T=array(83,83,83,83, 83,83,83,83, 83,83,83,0,   0,0,0,0, 0,0,0,0, 0,0,0,0)
    B=B:add(T)
    T=array(71,71,71,71, 71,71,71,71, 71,71,71,0,   76,76,76,0, 78,78,78,0, 82,82,82,0)
    B=B:add(T)
    T=array(82,0,82,0, 82,82,82,0, 0,0,76,76,   75,75,75,75, 75,75,75,75, 75,75,75,0,0)
    B=B:add(T)

# bass:
## Intro
    T=array(0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0)
    C=C:add(T)
    T=array(0,0,0,0, 0,0,0,0, 66,66,66,0, 66,66,66,66, 66,66,66,66, 66,66,66,0)
    C=C:add(T)

## Part 1
    T=array(59,59,59,0, 66,66,66,0, 71,71,71,0, 58,58,58,0, 66,66,66,0, 70,70,70,0)
    C=C:add(T)
    T=array(59,59,59,0, 66,66,66,0, 71,71,71,0, 63,63,63,0, 66,66,66,0, 71,71,71,0)
    C=C:add(T)
    T=array(59,59,59,0, 66,66,66,0, 71,71,71,0, 58,58,58,0, 66,66,66,0, 70,70,70,0)
    C=C:add(T)
    T=array(59,59,59,0, 66,66,66,0, 71,71,71,0, 63,63,63,0, 66,66,66,0, 71,71,71,0)
    C=C:add(T)
    T=array(61,61,61,0, 66,66,66,0, 70,70,70,0, 60,60,60,0, 65,65,65,0, 69,69,69,0)
    C=C:add(T)
    T=array(61,61,61,0, 66,66,66,0, 70,70,70,0, 58,58,58,0, 66,66,66,0, 70,70,70,0)
    C=C:add(T)
    T=array(61,61,61,0, 66,66,66,0, 70,70,70,0, 58,58,58,0, 66,66,66,0, 70,70,70,0)
    C=C:add(T)
    T=array(59,59,59,0, 66,66,66,0, 71,71,71,0, 54,54,54,0, 66,66,66,0, 71,71,71,0)
    C=C:add(T)

## Part 2
    T=array(59,59,59,0, 66,66,66,0, 75,75,75,0, 58,58,58,0, 66,66,66,0, 73,73,73,0)
    C=C:add(T)
    T=array(57,57,57,0, 66,66,66,0, 72,72,72,0, 60,60,60,0, 66,66,66,0, 75,75,75,0)
    C=C:add(T)
    T=array(61,61,61,0, 68,68,68,0, 76,76,76,0, 60,60,60,0, 68,68,68,0, 76,76,76,0)
    C=C:add(T)
    T=array(59,59,59,0, 68,68,68,0, 76,76,76,0, 58,58,58,0, 66,66,66,0, 76,76,76,0)
    C=C:add(T)
    T=array(47,47,47,0, 66,66,66,0, 75,75,75,0, 54,54,54,0, 66,66,66,0, 66,66,66,0)
    C=C:add(T)
    T=array(64,0,64,0, 64,64,64,0, 0,0,58,58, 59,59,59,59, 59,59,59,59, 59,59,59,0,0)
    C=C:add(T)

# Metadata
    T=array()
    Max=max(A:count(),B:count(),C:count()) #A:count()

    function title()
    {
        setName(Name+Mode+NEWLINE+"Playing ")
    }

    function spd()
    {
        if(PAL){
            Mode="PAL Mode"
            MUL=5/6
        }else{
            Mode="NTSC Mode"
            MUL=1
        }

        title()
    }

    function rs()
    {
        soundPlay(1,Max,AS)
        soundPlay(2,Max,BS)
        soundPlay(3,Max,CS)

        soundVolume(1,0.2*Vol)
        soundVolume(2,0.2*Vol)
        soundVolume(3,0.3*Vol)

        I=0
    }

    rs()

    AD=soundDuration(AS)
    BD=soundDuration(BS)
    CD=soundDuration(CS)

    spd()
}

interval((Tempo*6)/(100*MUL))

if (I > 120&I <= 230){Tempo=864}else{Tempo=864} #1000else864

if(I>Max){rs()}

M2=O:keyAttack2()

I++

AV=2^(A[I,number]/12)
BV=2^(B[I,number]/12)
CV=2^(C[I,number]/12)

soundPitch(1,AV)
soundPitch(2,BV)
soundPitch(3,CV)


if(M2&$M2&O:aimEntity()==E){
    PAL=!PAL
    spd()
}
